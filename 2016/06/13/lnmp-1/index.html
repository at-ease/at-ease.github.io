<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> lnmp · at-ease</title><meta name="description" content="lnmp - at-ease"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/at-ease" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">lnmp</h1><div class="post-info">2016年6月13日</div><div class="post-content"><p>lnmp的全名是linux+nginx+mysql+php，既然是全面优化那我们就从linux系统的选择入手。debian系统可以算是linux各分支中做的比较突出的一类，连谷歌都抛弃linux订制，由此可见debian系统之优秀，相较其它linux系统debian具有稳定、占用资源少对于网站web环境来说这些正是我们所需要的，其中debian6版本算是这一优点的集中体现。目前市面上有很多的安装包，其中军哥的lnmp是被站长使用较多的一种。</p>
<pre><code>也许有朋友会问小三啊，为啥不用lanmp呢？ 参考：[lnmp和lnmpa性能测试](http://m.baidu.com/from=1099b/bd_page_type=1/ssid=0/uid=0/pu=usm%400%2Csz%401320_2001%2Cta%40iphone_1_9.3_3_601/baiduid=A48FE8EB2515EC21405C18ECD3256ECB/w=0_10_512+lnmp/t=iphone/l=3/tc?m=8&amp;ntc=1&amp;srd=1&amp;dict=30&amp;title=lnmp%25u5168%25u9762%25u4F18%25u5316%25u96C6%25u5408nginx%2Bmysql%2Bphp&amp;tch=124.250.190.851.2.428%252C124.266.270.850.1.185&amp;clk_info=%257B%2522srcid%2522%253A%2522www_normal%2522%252C%2522tplname%2522%253A%2522www_normal%2522%252C%2522t%2522%253A1465093843301%252C%2522xpath%2522%253A%2522div-a-h3%2522%257D&amp;eqid=9c304b9b82d450001000000157538e93&amp;wd=&amp;tcid=ip1z7d9e&amp;src=http%3A%2F%2Fwww.zxsdw.com%2Findex.php%2Farchives%2F1111%2F)用nginx的目地是为提高并发能力。 在同一台机器上使用nginx反向 apache，等于脱裤子放屁。+_+*
</code></pre><p>一：lnmp的nginx优化</p>
<p>主要是修改 /usr/local/nginx/conf/nginx.conf</p>
<p>1.军哥的lnmp安装包中nginx的</p>
<p><strong>worker_processes</strong></p>
<p>默认设置是1，这里我们要根据服务器cpu具体的核心数来优化。通常4核的CPU我会把值设为3。</p>
<pre><code>**2核CPU，开启2个进程**worker_processes 2; worker_cpu_affinity 01 10; **4核CPU，开3个进程**worker_processes 3; worker_cpu_affinity [0010 0100 1000;](tel:0010%200100%201000;%208)**[8](tel:0010%200100%201000;%208)核CPU，开8个进程**worker_processes 8; worker_cpu_affinity [00000001](tel:00000001) [00000010](tel:00000010) [00000100](tel:00000100) [00001000](tel:00001000) [00010000](tel:00010000) [00100000](tel:00100000) [01000000](tel:01000000) [10000000](tel:10000000); 
</code></pre><p>worker_processes参数解析可参考：</p>
<p><a href="http://m.baidu.com/from=1099b/bd_page_type=1/ssid=0/uid=0/pu=usm%400%2Csz%401320_2001%2Cta%40iphone_1_9.3_3_601/baiduid=A48FE8EB2515EC21405C18ECD3256ECB/w=0_10_512+lnmp/t=iphone/l=3/tc?m=8&amp;ntc=1&amp;srd=1&amp;dict=30&amp;title=lnmp%25u5168%25u9762%25u4F18%25u5316%25u96C6%25u5408nginx%2Bmysql%2Bphp&amp;tch=124.250.190.851.2.428%252C124.266.270.850.1.185&amp;clk_info=%257B%2522srcid%2522%253A%2522www_normal%2522%252C%2522tplname%2522%253A%2522www_normal%2522%252C%2522t%2522%253A1465093843301%252C%2522xpath%2522%253A%2522div-a-h3%2522%257D&amp;eqid=9c304b9b82d450001000000157538e93&amp;wd=&amp;tcid=ip1z7d9e&amp;src=http%3A%2F%2Fwww.zxsdw.com%2Findex.php%2Farchives%2F860%2F" target="_blank" rel="external">worker_processes详解</a></p>
<p>2.<strong>worker_rlimit_nofile参数</strong>默认是5xxxx.</p>
<pre><code>worker_rlimit_nofile 65535;  events  {   use epoll;   worker_connections 32700;  }
</code></pre><p>worker_rlimit_nofile参数讲解可参考：<a href="http://m.baidu.com/from=1099b/bd_page_type=1/ssid=0/uid=0/pu=usm%400%2Csz%401320_2001%2Cta%40iphone_1_9.3_3_601/baiduid=A48FE8EB2515EC21405C18ECD3256ECB/w=0_10_512+lnmp/t=iphone/l=3/tc?m=8&amp;ntc=1&amp;srd=1&amp;dict=30&amp;title=lnmp%25u5168%25u9762%25u4F18%25u5316%25u96C6%25u5408nginx%2Bmysql%2Bphp&amp;tch=124.250.190.851.2.428%252C124.266.270.850.1.185&amp;clk_info=%257B%2522srcid%2522%253A%2522www_normal%2522%252C%2522tplname%2522%253A%2522www_normal%2522%252C%2522t%2522%253A1465093843301%252C%2522xpath%2522%253A%2522div-a-h3%2522%257D&amp;eqid=9c304b9b82d450001000000157538e93&amp;wd=&amp;tcid=ip1z7d9e&amp;src=http%3A%2F%2Fwww.zxsdw.com%2Findex.php%2Farchives%2F742%2F" target="_blank" rel="external">nginx优化参数详解</a></p>
<p>添加防压力测试<br>if ($http_user_agent ~ ApacheBench|WebBench|Jmeter|must-revalidate|Havij) {retun 503;}<br>添加针对CVE-2013-4547链接空格的补丁<br>if ($request_uri ~ “ “) {return 444;}</p>
<p>二：lnmp的mysql优化用/usr/local/mysql/share/mysql/目录下的my-large.cnf 文件替换根目录etc下的my.cnf文件</p>
<p>my-huge.cnf: 适合1GB - 2GB RAM主机使用<br>my-large.cnf: 适合 512MB RAM使用<br>my-medium.cnf: 只有 32MB - 64MB RAM使用<br>my-small.cnf:小于64MB 用，MySQL会占用很少资源<br>my-innodb-heavy-4G.cnf 适合4G以上使用</p>
<pre><code>禁用mysql日志： 修改 /etc/my.cnf 文件 在log-bin=mysql-bin和binlog_format=mixed  这两行前面加#注释掉即可。  在query_cache_size= 16M下面添加一行： tmp_table_size = 200M
</code></pre><p>mysql参数讲解可参考：<a href="http://m.baidu.com/from=1099b/bd_page_type=1/ssid=0/uid=0/pu=usm%400%2Csz%401320_2001%2Cta%40iphone_1_9.3_3_601/baiduid=A48FE8EB2515EC21405C18ECD3256ECB/w=0_10_512+lnmp/t=iphone/l=3/tc?m=8&amp;ntc=1&amp;srd=1&amp;dict=30&amp;title=lnmp%25u5168%25u9762%25u4F18%25u5316%25u96C6%25u5408nginx%2Bmysql%2Bphp&amp;tch=124.250.190.851.2.428%252C124.266.270.850.1.185&amp;clk_info=%257B%2522srcid%2522%253A%2522www_normal%2522%252C%2522tplname%2522%253A%2522www_normal%2522%252C%2522t%2522%253A1465093843301%252C%2522xpath%2522%253A%2522div-a-h3%2522%257D&amp;eqid=9c304b9b82d450001000000157538e93&amp;wd=&amp;tcid=ip1z7d9e&amp;src=http%3A%2F%2Fwww.zxsdw.com%2Findex.php%2Farchives%2F858%2F" target="_blank" rel="external">mysql优化</a></p>
<p>三：lnmp的php相关参数优化</p>
<p>优化主要是修改/usr/local/php/etc/目录下的php-fpm.conf和php.ini文件</p>
<p><strong>1.php-fpm.conf参数优化</strong></p>
<p>删除value name=”display_errors” 这一行的代码，防止坏人从PHP错误中找到漏洞。</p>
<p>max_children默认参数是开启5个进程。数值要根据内存大小来定，每一个php-cgi所耗费的内存在20M左右。</p>
<pre><code>126M内存默认即可 256M 10个 512M 20个 1G 40个
</code></pre><p>request_terminate_timeout参数默认是0s，修改为300s</p>
<p>rlimit_files参数默认5xxxx，修改为65535</p>
<p>php-fpm参数讲解可参考：<a href="http://m.baidu.com/from=1099b/bd_page_type=1/ssid=0/uid=0/pu=usm%400%2Csz%401320_2001%2Cta%40iphone_1_9.3_3_601/baiduid=A48FE8EB2515EC21405C18ECD3256ECB/w=0_10_512+lnmp/t=iphone/l=3/tc?m=8&amp;ntc=1&amp;srd=1&amp;dict=30&amp;title=lnmp%25u5168%25u9762%25u4F18%25u5316%25u96C6%25u5408nginx%2Bmysql%2Bphp&amp;tch=124.250.190.851.2.428%252C124.266.270.850.1.185&amp;clk_info=%257B%2522srcid%2522%253A%2522www_normal%2522%252C%2522tplname%2522%253A%2522www_normal%2522%252C%2522t%2522%253A1465093843301%252C%2522xpath%2522%253A%2522div-a-h3%2522%257D&amp;eqid=9c304b9b82d450001000000157538e93&amp;wd=&amp;tcid=ip1z7d9e&amp;src=http%3A%2F%2Fwww.zxsdw.com%2Findex.php%2Farchives%2F204%2F%3Fpage%3D2" target="_blank" rel="external">php-fpm详解</a></p>
<p><strong>2.php.ini参数优化</strong></p>
<p>disable_functions = 默认禁用了一些参数，PHP中有一些函数的风险性还是相当大的,如果允许这些函数执行,当PHP 程序出现漏洞时,损失是非常严重的</p>
<pre><code>fsockopen这个参数用的比较多，可以删除。  另外从安全方面考虑可隐藏PHP版本号 将文件里面的 expose_php = On  修改为 expose_php = Off 即可  将display_errors =On改为Off 
</code></pre><p>最后修改最大连接数使重启后也可生效，在/etc/profile 最后增加一行 ulimit -SHn 65535</p>
<p>另外军哥的LNMP安装包里有一个eAccelerator的安装文件。最好装一下。这个是加速PHP缓存的还不错。<br>关于eAccelerator的设置我就给出两个修改的地方吧：</p>
<pre><code>eaccelerator.shm_size=&quot;16&quot; 
</code></pre><p>#默认是占用16M共享内存，军哥好像是1，你就改成16吧。大小也可根据你的内存情况设置。</p>
<p>另外军哥默认是eaccelerator缓存目录是/usr/local/eaccelerator_cache，这样用硬盘缓存的话，某些情况会影响php的响应时间。我们可以直接放到共享内存里面老。<br>运行命令：mkdir -p /dev/shm/eaccelerator_cache<br>修改目录为以下就OK了。</p>
<pre><code>eaccelerator.cache_dir=&quot;/dev/shm/eaccelerator_cache&quot;
</code></pre><p><strong>最后全部修改完记得重启生效：/root/lnmp restart</strong></p>
<pre><code>老外vps无特别说明(即使用优惠码)都按优惠后的价格续费。此vps无爱可看之前其它文章 发现Out of Stock说明缺货中，可考虑购买其它VPS。自备谷歌浏览器有简单的翻译功能。
</code></pre><p><a href="http://m.baidu.com/from=1099b/bd_page_type=1/ssid=0/uid=0/pu=usm%400%2Csz%401320_2001%2Cta%40iphone_1_9.3_3_601/baiduid=A48FE8EB2515EC21405C18ECD3256ECB/w=0_10_512+lnmp/t=iphone/l=3/tc?m=8&amp;ntc=1&amp;srd=1&amp;dict=30&amp;title=lnmp%25u5168%25u9762%25u4F18%25u5316%25u96C6%25u5408nginx%2Bmysql%2Bphp&amp;tch=124.250.190.851.2.428%252C124.266.270.850.1.185&amp;clk_info=%257B%2522srcid%2522%253A%2522www_normal%2522%252C%2522tplname%2522%253A%2522www_normal%2522%252C%2522t%2522%253A1465093843301%252C%2522xpath%2522%253A%2522div-a-h3%2522%257D&amp;eqid=9c304b9b82d450001000000157538e93&amp;wd=&amp;tcid=ip1z7d9e&amp;src=http%3A%2F%2Fwww.zxsdw.com%2Findex.php%2Farchives%2F881%2F" target="_blank" rel="external">7</a></p>
<p>买老外的域名、vps都需美元。有信用卡可直接购买。无卡无美元的注册Paypal到淘宝找人充美元即可。老外VPS购买教程参考：<a href="http://www.zxsdw.com/index.php/archives/259/" target="_blank" rel="external">http://www.zxsdw.com/index.php/archives/259/</a> </p>
<h4 id="已有-7-条评论-»"><a href="#已有-7-条评论-»" class="headerlink" title="已有 7 条评论 »"></a>已有 7 条评论 »</h4><p>张小三资源网QQ交流群：<a href="tel:292348362" target="_blank" rel="external">292348362</a></p>
<h3 id="VPS新手教程"><a href="#VPS新手教程" class="headerlink" title="VPS新手教程"></a>VPS新手教程</h3><p>点击查看更多</p>
<h3 id="最新文章"><a href="#最新文章" class="headerlink" title="最新文章"></a>最新文章</h3><p>点击查看更多</p>
<h3 id="最近回复"><a href="#最近回复" class="headerlink" title="最近回复"></a>最近回复</h3><p><a href="http://m.baidu.com/from=1099b/bd_page_type=1/ssid=0/uid=0/pu=usm%400%2Csz%401320_2001%2Cta%40iphone_1_9.3_3_601/baiduid=A48FE8EB2515EC21405C18ECD3256ECB/w=0_10_512+lnmp/t=iphone/l=3/tc?m=8&amp;ntc=1&amp;srd=1&amp;dict=30&amp;title=lnmp%25u5168%25u9762%25u4F18%25u5316%25u96C6%25u5408nginx%2Bmysql%2Bphp&amp;tch=124.250.190.851.2.428%252C124.266.270.850.1.185&amp;clk_info=%257B%2522srcid%2522%253A%2522www_normal%2522%252C%2522tplname%2522%253A%2522www_normal%2522%252C%2522t%2522%253A1465093843301%252C%2522xpath%2522%253A%2522div-a-h3%2522%257D&amp;eqid=9c304b9b82d450001000000157538e93&amp;wd=&amp;tcid=ip1z7d9e&amp;src=http%3A%2F%2Fwww.zxsdw.com%2F" target="_blank" rel="external">张小三资源网</a>is powered by Typecho))) <a href="http://m.baidu.com/from=1099b/bd_page_type=1/ssid=0/uid=0/pu=usm%400%2Csz%401320_2001%2Cta%40iphone_1_9.3_3_601/baiduid=A48FE8EB2515EC21405C18ECD3256ECB/w=0_10_512+lnmp/t=iphone/l=3/tc?m=8&amp;ntc=1&amp;srd=1&amp;dict=30&amp;title=lnmp%25u5168%25u9762%25u4F18%25u5316%25u96C6%25u5408nginx%2Bmysql%2Bphp&amp;tch=124.250.190.851.2.428%252C124.266.270.850.1.185&amp;clk_info=%257B%2522srcid%2522%253A%2522www_normal%2522%252C%2522tplname%2522%253A%2522www_normal%2522%252C%2522t%2522%253A1465093843301%252C%2522xpath%2522%253A%2522div-a-h3%2522%257D&amp;eqid=9c304b9b82d450001000000157538e93&amp;wd=&amp;tcid=ip1z7d9e&amp;src=http%3A%2F%2Fwww.zxsdw.com%2Fsitemap.xml" target="_blank" rel="external">网站地图</a></p>
</div></article></div></section><footer><div class="paginator"><a href="/2016/06/13/jljklj copy 2/" class="prev">上一篇</a><a href="/2016/06/13/1write/" class="next">下一篇</a></div><div data-thread-key="2016/06/13/lnmp-1/" data-title="lnmp" data-url="http://at-ease.github.io/2016/06/13/lnmp-1/" data-author-key="1" class="ds-thread"></div><script>var duoshuoQuery = {short_name:"at-ease"};
(function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
})();

</script><div class="copyright"><p>© 2015 - 2016 <a href="http://at-ease.github.io">at-ease</a>, unless otherwise noted.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>